---
layout: post
title: "Android 安全沙箱机制"
tags: [Android]
description: 安卓的权限机制，数字签名，Linux内核守护，JAVA虚拟机，安卓沙箱.
categories: [Android]
---

#### 郝生曰：“女子无情时 负人最狠 。女子痴情时 感人至深！”《論語》
##### [TagNo] 专心学习 NO恋爱 异地 拒绝

##### 今天和小伙伴一起学习安卓沙箱机制，这货据说可是安全的一匹

* Android 沙箱实现了应用程序的相互隔离，用于对文件系统的实体访问进行控制，也可以对其他Android系统资源进行访问控制。
* window与unix/linux等传统操作系统以用户为中心，假设用户之间是不可信的，更多考虑如何隔离不同用户对资源（存储区域与用户文件，内存区域与用户进程，底层设备等）的访问。


* 在Android系统中，假设应用软件之间是不可信的，甚至用户自行安装的应用程序也是不可信的，因此，首先需要限制应用程序的功能，也就是将应用程序置于“沙箱”之内，实现应用程序之间的隔离，并且设定允许或拒绝API调用的权限，控制应用程序对资源的访问，如访问文件，目录，网络，传感器等。


* 简单的说，每个应用程序无法访问其他应用程序的资源。沙箱系统的原理主要基于Linux系统的UID/GID机制。Android对传统的
Linux的UID/GID机制进行了修改。在 Linux 中，一个用户 ID 识别一个给定用户;在 Android 上，一个用户 ID 识别一个应用程序。

* 在默认状态下，应用程序之间无法交互，运行在进程沙箱内的应用程序没有被分配权限，无法访问系统或资源。

* 应用程序在安装时被分配用户 ID，应用程序在设备上的存续期间内，用户 ID 保持不变。权限是关于允许或限制应用程序(而不是用户)访问设备资源。


* Android ID 映射表(AID) 
	1. 底层Linux系统保证分配程序UID
	2. Linux系统的UID/GID(用户组ID)的权限模型
	3. 保留了一段AID范围，用于提供给原生应用作为UID
	4. 用户UID范围，10000-19999
	5. Android系统上最多能安装9999个应用

---

* 系统服务权限 AndroidManifest文件中定义
	1. 系统服务Service有这样一个属 android:isolatedProcess
	2. 属性值为true的时候，服务会在一个特殊的进程下运行
	3. 这个进程与系统其他进程分开且没有自己的权限
	4. 与其通信的唯一途径是通过服务的bind方法

---
#### 应用权限与文件权限机制
1. 任何一个应用程序在使用Android受限资源（网络、电话、短信、蓝牙、通讯录、SdCard等）之前都必须以XML文件的形式事先向Android系统提出申请
2. 等待Android系统批准后应用程序方可使用相应的资源，权限与Java的API是多对多的映射关系。
3. Android中的数据分为system和data两个区，其中system是只读的，data/data+包名是用来存放应用自己的数据，这样保证系统数据不会被随意改写。
4. 如何让两个app运行在同一个进程里？ 

	1. 两个app用相同的private key来签名。 
	2. 两个app的Manifest文件中添加android:sharedUserId 设置成相同的UID。

5. ROOT用户，所有获得此权限的都是粑粑，可以 操作系统的所有，建议开发模拟器使用，真机就算了吧
    
